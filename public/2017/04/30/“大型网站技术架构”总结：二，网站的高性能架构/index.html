<!DOCTYPE html><html lang="en-us"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>“大型网站技术架构”总结：二，网站的高性能架构 | 曜彤.手记</title><meta name="description" content="第二篇读书总结，主要围绕着如何从多个方面来进行“高性能网站架构”来展开，性能优化小到一行代码的重构，大到服务器集群的重新架构设计。怎样通过各项数据指标来监控网站的实时性能？只有找出网站的性能“弱点”，并以此作为目标来进行迭代式的优化，才能够逐渐将网站架构演进到一个高性能的水平。"><meta name="generator" content="曜彤.手记"><meta name="author" content="于航(曜彤)"><meta name="keywords" content="博客, C++, C, VB, Web, Java, IT, 编程, 开发, Android, Python, MySQL, 科技, 黑客, 技术, Javascript, 云, 大数据, 计算, 机器学习, AI, 人工智能, 创业, 产品, 公司, WebAssembly, Wasm"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,user-scalable=0"><link rel="stylesheet" type="text/css" href="/styles/screen.css"><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-touch-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-touch-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-touch-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-touch-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-touch-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-touch-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-180x180.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"><link rel="icon" type="image/png" sizes="128x128" href="/images/favicon-128.png"><link rel="icon" type="image/png" sizes="196x196" href="/images/favicon-196x196.png"><meta name="msapplication-TileColor" content="#FFFFFF"><meta name="msapplication-TileImage" content="mstile-144x144.png"><meta name="msapplication-square70x70logo" content="mstile-70x70.png"><meta name="msapplication-square150x150logo" content="mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="mstile-310x150.png"><meta name="msapplication-square310x310logo" content="mstile-310x310.png"><link rel="stylesheet" href="/css/prism-okaidia.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body itemscope itemtype="https://schema.org/WebPage"><div class="canvas-containter"><span>X</span></div><header itemscope itemtype="https://schema.org/WPHeader"><div class="logo"></div><h1><a href="/" alt="曜彤.手记" title="曜彤.手记" itemprop="headline">曜彤.手记</a></h1><p itemprop="description">随手写写，关于互联网技术、产品与创业</p><nav itemscope itemtype="https://schema.org/SiteNavigationElement"><ul><li itemprop="name" class="menu-item"><a href="/ " alt="首页" title="首页" itemprop="url">首页</a></li><li itemprop="name" class="menu-item"><a href="/articles" alt="文章" title="文章" itemprop="url">文章</a></li><li itemprop="name" class="menu-item"><a href="/works" alt="作品" title="作品" itemprop="url">作品</a></li><li itemprop="name" class="menu-item"><a href="/tags" alt="标签" title="标签" itemprop="url">标签</a></li><li itemprop="name" class="menu-item"><a href="/author" alt="关于" title="关于" itemprop="url">关于</a></li></ul></nav><div class="space"></div></header><main itemscope itemtype="https://schema.org/Blog"><script src="/scripts/index.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/zoomage.js@latest/dist/zoomage.min.js" type="text/javascript"></script><script src="https://shadow.elemecdn.com/npm/axios@0.18.0/dist/axios.min.js" type="text/javascript"></script><div class="touch-top"><span></span></div><article post-id="7f6b54071905541ba701c95d78034815" class="full"><h1 itemprop="headline" class="post-heading">“大型网站技术架构”总结：二，网站的高性能架构</h1><div class="article-meta"><span class="post-meta"><br>Created on<time itemprop="dateCreated" datetime="2017-04-30T03:02:23.000Z"> 2017 / 04 / 30, 11:02:23</time></span><span class="page-tag-anchor"><a href="/tags/后端" itemprop="url">#后端</a>&nbsp;&nbsp;<a href="/tags/架构" itemprop="url">#架构</a>&nbsp;&nbsp;</span></div><br><p>第二篇读书总结，主要围绕着如何从多个方面来进行“高性能网站架构”来展开，性能优化小到一行代码的重构，大到服务器集群的重新架构设计。怎样通过各项数据指标来监控网站的实时性能？只有找出网站的性能“弱点”，并以此作为目标来进行迭代式的优化，才能够逐渐将网站架构演进到一个高性能的水平。</p>
<h4 id="一、网站性能测试："><a href="#一、网站性能测试：" class="headerlink" title="一、网站性能测试："></a>一、网站性能测试：</h4><p>网站的性能指标，既可以是开发人员客观的性能分析数据，测试指标。也可以是主观的终端用户体验感受。一般而言，我们用如下一些指标来衡定一个网站的性能水平：<strong>响应时间、并发数量、吞吐量、性能计数器</strong>。响应时间即从请求发出开始，到收到响应并解析成对应可视化结果所花费的时间；并发数指系统能够<strong>同时</strong>处理的请求数量。吞吐量是指<strong>单位时间</strong>内系统能够处理的请求数量，常用的单位为 TPS（每秒事务数）、HPS（每秒 HTTP 请求数）、QPS（每秒数据库查询数）；性能计数器为直观的数据指标，比如当前系统负载、对象与线程数、CPU / 内存使用率、磁盘与网络 IO 等。理想的系统负载应该对应为系统的 CPU 数量，因为系统负载指当前正在排队被 CPU 处理的进程数量。</p>
<p>常见的测试方法分为：<strong>性能测试、负载测试、压力测试</strong>和<strong>稳定性测试</strong>。性能测试用来验证在资源可接受范围内，系统在一定压力下能否达到预期的性能指标。负载测试用来测试当系统资源满载时，系统能够达到的最大吞吐量。压力测试则是在超过系统安全负载时继续施加压力，测试直到系统奔溃所用时间的长短。而稳定性测试则是让系统在一定压力下运行一段时间，检测系统在不同时间点是否有资源的使用异常，以此来推断系统的稳定性。</p>
<p>在性能测试和负载测试中，系统的 TPS 随着压力的增加，值会不断增高。而在压力测试下，由于此时系统资源早已耗尽，更多的压力只会拖垮 CPU 的性能，因此此时的系统 TPS 会随着压力的不断增加而逐渐降低。而系统的响应时间在所有测试中都是随着压力的增加而逐渐增加的，不过在压力测试中，每对系统施加单位的压力，系统的响应时间会成倍的疯狂增长。</p>
<p>对于系统性能的优化，需要从一个请求出发，记录下请求达到每个关键节点（比如代理服务器，负载均衡服务器，应用服务器）的时间，分析哪段时间不合理，再通过分析监控数据来检测问题所在。</p>
<h4 id="二、WEB-前端优化："><a href="#二、WEB-前端优化：" class="headerlink" title="二、WEB 前端优化："></a>二、WEB 前端优化：</h4><p><strong>合并资源</strong>、<strong>分离静态资源到独立域名</strong>（防止 Cookie 污染）、<strong>浏览器本地缓存</strong>、<strong>服务器 GZip 压缩</strong>、<strong>CDN 加速</strong>（ISP端）、<strong>使用反向代理</strong>（相当于 Gateway 主机，可缓存资源，还可以保护内部网络）等方式。</p>
<h4 id="三、应用服务器优化："><a href="#三、应用服务器优化：" class="headerlink" title="三、应用服务器优化："></a>三、应用服务器优化：</h4><p>应用服务器主要用来处理系统业务，是整个网站架构中的核心，也是最复杂、变化最多的部分。常用的优化手段有：<strong>使用分布式缓存</strong>（网站优化第一定律：优先考虑使用缓存。缓存不适用于频繁修改的数据，不适用与没有热点访问的数据，并且容易产生“脏读”。系统的正常运行不应该依赖于缓存系统，初始的缓存系统可以先进行“<strong>缓存预热</strong>”，比如 Redis 在初始化时会从硬盘中读取数据放到内存。如果在日志中发现大量的无法命中缓存的请求，这可能是发生了“<strong>缓存穿透</strong>”，恶意用户持续高并发的访问系统不存在的资源，这些资源无法被缓存下来导致了穿透问题，一个简单的对策是将不存在的数据也缓存起来。常见的分布式缓存系统如 JBoss 和 Memcache；JBoss 的所有集群机器在数据改变时会在所有机器更新；而 Memcache 采用了 Leader 的方式，各个主机间不进行通信，因此<strong>其线性伸缩不会影响缓存系统的性能</strong>）。<strong>使用共享队列</strong>、<strong>使用集群</strong>、<strong>代码优化</strong>（采用多线程，线程数一般与 CPU 数量成正比，使用无状态对象或者加锁来防止一致性问题，数据连接、通信连接等资源复用）。</p>
<h4 id="四、存储系统优化："><a href="#四、存储系统优化：" class="headerlink" title="四、存储系统优化："></a>四、存储系统优化：</h4><p>使用 SSD 硬盘、使用 NoSQL 数据库（由于 LSM 树的数据更新速度较 B+ 树更快）、根据需求使用 RAID 磁盘阵列和 HDFS（RAID 可以在一定程度上改善磁盘的访问延迟同时增强可用性。但对于大量数据的存储需求，基于 MapReduce 可以进行并发任务处理的 HDFS 可能更加合适）。</p>
<br><div class="article-bottom-meta"><span class="post-meta">Last updated on<time itemprop="dateModified" datetime="2017-04-30T03:02:23.000Z"> 2019 / 02 / 17, 23:22:40</time></span></div></article><br><div class="article-end-saparator"><span class="line"></span><span class="text">文章底线，下面是评论</span><span class="line"></span></div><div class="comments-display-container"><div class="placeholder"><i class="fa fa-battery-empty">&nbsp;&nbsp;暂无评论，欢迎勾搭 :)</i></div></div><div class="dot-decoration"></div><div class="comments-input"><textarea name="comment" placeholder="请输入评论内容 ..."></textarea><div><input type="text" placeholder="请输入昵称 ..."><button class="submit-comment">发布</button></div></div><span class="next-post"><a href="/2017/04/29/“大型网站技术架构”总结：一，概述/" itemprop="url">Older Post ⇒</a></span><span class="prev-post"><a href="/2017/05/02/“大型网站技术架构”总结：三，网站的高可用架构/" itemprop="url">⇐ Next Post </a></span><br><br><br><br><br></main></body></html>